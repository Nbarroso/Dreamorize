<div id="sp-nav" ng-include src="'partials/sidebar.html'"></div>
<div id="sp-page" class="page" ng-controller="memCtrl">

<!--<header id="header"></header> -->
<div id="header" ng-include src="header.url"></div>
 

<table class="tab_question">
	<tr>
		<td>
			<a href="#questions_personnage">
		    <button class="bouton">
		       <span class="icon-fleche"></span>
		    </button>
	    	</a>
	    </td>
		<td>&nbsp;</td>
		<td>
			<p class="intitule_question">ACTIONS DANS TON RÊVE ?</p>
		</td>
		<td>&nbsp;</td>
		<td>
			<a href="#questions_keywords">
		        <button class="bouton">
		            <span class="icon-fleche"></span>
		        </button>
	    	</a>
		</td>
	</tr>
</table>

<div class='all_content'>

<div class="date_element">

	<input type="text" id="action_field" ng-model="action" placeholder="ENTRE UN VERBE" class="action_reve"/> <span id="action_ok"  ng-click='addAction(action);'class="icon-ok mini-icon"></span>

	<div id="action_list" style='padding-top: 20px;'></div>

	<table id="tableau_choix_categorie_action" style="display: none; opacity: 0;">
		<caption style="font-size: 20px; padding: 10px">CHOISIS UNE CATEGORIE</caption>
		<tr>
			<td><span ng-click="addCategorieAction(4)" class='choix_cat_action icon-mouvement' id="mouvement"></span></td>
			<td><span ng-click="addCategorieAction(2)"class='choix_cat_action icon-creation'></span></td>
			<td><span ng-click="addCategorieAction(3)"class='choix_cat_action icon-destruction'></span></td>
		</tr>
		<tr>
			<td class="categorie_action_titre">Mouvement</td>
			<td class="categorie_action_titre">Créer</td>
			<td class="categorie_action_titre">Détruire</td>
		</tr>
		<tr>
			<td><span ng-click="addCategorieAction(1)" class='choix_cat_action icon-echanger'></span></td>
			<td><span ng-click="addCategorieAction(5)" class='choix_cat_action icon-psychologique'></span></td>
			<td><span ng-click="addCategorieAction(6)" class='choix_cat_action icon-autre'></span></td>
		</tr>
		<tr>
			<td class="categorie_action_titre">Echanger</td>
			<td class="categorie_action_titre">Emotion</td>
			<td class="categorie_action_titre">Autre</td>
		</tr>

	</table>


	<script type="text/javascript">


		var userId = 1;
        var jsonVerbs;

        var toType = function(obj) {
  			return ({}).toString.call(obj).match(/\s([a-zA-Z]+)/)[1].toLowerCase()
		}

        function access(data){
        	var parser = new DOMParser();
			var xmlDoc = parser.parseFromString(data.responseText,"text/xml");
			var stringVerbs = xmlDoc.getElementById("verb_list").childNodes[1].innerHTML;
			var jsonVerbs = JSON.parse("[" + stringVerbs + "]");
			var verbsArray = new Array();

			for(var i in jsonVerbs) {
			   	for(var j in jsonVerbs[i]){
			   		verbsArray.push(jsonVerbs[i][j]);
			   		verbsArray.push("se " + jsonVerbs[i][j]);
			   	}  
			}

			$("#action_field").autocomplete({
				source: verbsArray,
				minLength: 1
			});

			// Remplace le filtre par défaut d'autocomplétion pour chercher seulement au début des chaines de caractères
    		$.ui.autocomplete.filter = function (array, term) {
		        var matcher = new RegExp("^" + $.ui.autocomplete.escapeRegex(term), "i");
		       	return $.grep(array, function (value) {
		            return matcher.test(value.label || value.value || value);
		        });
    		};
        }

        $.ajax({
            url: "http://dreamorize.meximas.com/back_office/app/searchVerbs.php",
            type: 'get',
            
            
            success: function(data) {
                result = data;
                access(data);
            }
        });

		

		var nbAction = 0;
		var actionsArray = new Array();

		$('#action_field').focus(function(){
	   		$(this).removeAttr('placeholder');
		});

		$('#action_ok').click(function(event) {

			if($('#action_field').val() != ''){


				var actionDoesntExist = true;
				$.each(actionsArray, function(index, val) {
					 if($('#action_field').val() == val){
					 	actionDoesntExist = false;
					 	//$('#tag_field').val('Tu as déjà entré ce mot.');
					 	$('#action_field').attr("placeholder", "Existe déjà. Réesaie...");
					 	$('#action_field').val('');
					 	console.log('existe déjà');
					 }
				});

				if(actionDoesntExist){

					nbAction++;
					var action = $('#action_field').val();
					actionsArray.push(action);
					$('#action_field').attr("placeholder", "ENTRE UN VERBE");
					$('#action_field').val('');
					$('#action_list').append("<p id='action_item"+nbAction+"' class='action_item' style='opacity: 0;display: none;'>" + action + "</p></div><br>" );

					 /*$("#first").animate({
					       width: '200px'
					    }, { duration: 200, queue: false });
					    $("#second").animate({
					       width: '600px'
					    }, { duration: 200, queue: false });*/
					
					
					$("#boutons_final_actions").animate({marginTop: '200px',opacity: 0, 'useTranslate3d': true }, {duration :500, queue: false}, function(){

						$("#boutons_final_actions").css({display: 'none'});
						// Tableau choix categories
						$('#tableau_choix_categorie_action').css({display: 'inline-block'});
						$('#tableau_choix_categorie_action').animate({ opacity: 100 }, 5000);
						
					});
					
					// Action
					$('#action_item'+nbAction).css({display: 'inline-block'});
					$('#action_item'+nbAction).animate({ 'opacity': '100'}, {duration : 5000, queue : false});
				}
			}
		});

		$('.choix_cat_action ').click(function(event) {
			$('#tableau_choix_categorie_action').animate({ opacity: 0 }, 1000, function() {

				$('#tableau_choix_categorie_action').css({display: 'none'});

				$("#boutons_final_actions").css({display: 'margin-top'});

				$("#boutons_final_actions").css({'margin-top' : '200px', opacity: 100});
				$("#boutons_final_actions").animate({marginTop: '0px','useTranslate3d': true}, 500);
 			});
		});

	</script>




</div>
	<table class="boutons_annuler_valider" id="boutons_final_actions">
		<tr>
			<td>
				<a href="#questions_action">        
			        <button class="bouton">
			            <span class="icon-croix"></span>
			        </button>
		    	</a>
			</td>
			<td>
				<a href="#questions_keywords">        
			        <button class="bouton">
			            <span class="icon-ok"></span>
			        </button>
		    	</a>
			</td>
		</tr>
	</table>



	<footer id="evolution_questionnaire">      
		<img src="img/dreamorize_evolution.png" alt="DREAMORIZE - Evolution du questionnaire">
	</footer>

</div>

<script type="text/javascript" src="js/jquery.hammer.full.min.js"></script>    
<script type="text/javascript" src="js/hammer_menu.js"></script>